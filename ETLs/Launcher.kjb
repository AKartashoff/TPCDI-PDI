<?xml version="1.0" encoding="UTF-8"?>
<job>
  <name>Launcher</name>
  <description/>
  <extended_description/>
  <job_version/>
  <directory>/</directory>
  <created_user>-</created_user>
  <created_date>2020/09/11 17:50:41.941</created_date>
  <modified_user>-</modified_user>
  <modified_date>2020/09/11 17:50:41.941</modified_date>
  <parameters>
    </parameters>
  <connection>
    <name>tpcdi</name>
    <server>${tpcdi.host}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>${tpcdi.dbname}</database>
    <port>5432</port>
    <username>${tpcdi.username}</username>
    <password>${tpcdi.password}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <slaveservers>
    </slaveservers>
  <job-log-table>
    <connection/>
    <schema/>
    <table/>
    <size_limit_lines/>
    <interval/>
    <timeout_days/>
    <field>
      <id>ID_JOB</id>
      <enabled>Y</enabled>
      <name>ID_JOB</name>
    </field>
    <field>
      <id>CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>CHANNEL_ID</name>
    </field>
    <field>
      <id>JOBNAME</id>
      <enabled>Y</enabled>
      <name>JOBNAME</name>
    </field>
    <field>
      <id>STATUS</id>
      <enabled>Y</enabled>
      <name>STATUS</name>
    </field>
    <field>
      <id>LINES_READ</id>
      <enabled>Y</enabled>
      <name>LINES_READ</name>
    </field>
    <field>
      <id>LINES_WRITTEN</id>
      <enabled>Y</enabled>
      <name>LINES_WRITTEN</name>
    </field>
    <field>
      <id>LINES_UPDATED</id>
      <enabled>Y</enabled>
      <name>LINES_UPDATED</name>
    </field>
    <field>
      <id>LINES_INPUT</id>
      <enabled>Y</enabled>
      <name>LINES_INPUT</name>
    </field>
    <field>
      <id>LINES_OUTPUT</id>
      <enabled>Y</enabled>
      <name>LINES_OUTPUT</name>
    </field>
    <field>
      <id>LINES_REJECTED</id>
      <enabled>Y</enabled>
      <name>LINES_REJECTED</name>
    </field>
    <field>
      <id>ERRORS</id>
      <enabled>Y</enabled>
      <name>ERRORS</name>
    </field>
    <field>
      <id>STARTDATE</id>
      <enabled>Y</enabled>
      <name>STARTDATE</name>
    </field>
    <field>
      <id>ENDDATE</id>
      <enabled>Y</enabled>
      <name>ENDDATE</name>
    </field>
    <field>
      <id>LOGDATE</id>
      <enabled>Y</enabled>
      <name>LOGDATE</name>
    </field>
    <field>
      <id>DEPDATE</id>
      <enabled>Y</enabled>
      <name>DEPDATE</name>
    </field>
    <field>
      <id>REPLAYDATE</id>
      <enabled>Y</enabled>
      <name>REPLAYDATE</name>
    </field>
    <field>
      <id>LOG_FIELD</id>
      <enabled>Y</enabled>
      <name>LOG_FIELD</name>
    </field>
    <field>
      <id>EXECUTING_SERVER</id>
      <enabled>N</enabled>
      <name>EXECUTING_SERVER</name>
    </field>
    <field>
      <id>EXECUTING_USER</id>
      <enabled>N</enabled>
      <name>EXECUTING_USER</name>
    </field>
    <field>
      <id>START_JOB_ENTRY</id>
      <enabled>N</enabled>
      <name>START_JOB_ENTRY</name>
    </field>
    <field>
      <id>CLIENT</id>
      <enabled>N</enabled>
      <name>CLIENT</name>
    </field>
  </job-log-table>
  <jobentry-log-table>
    <connection/>
    <schema/>
    <table/>
    <timeout_days/>
    <field>
      <id>ID_BATCH</id>
      <enabled>Y</enabled>
      <name>ID_BATCH</name>
    </field>
    <field>
      <id>CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>CHANNEL_ID</name>
    </field>
    <field>
      <id>LOG_DATE</id>
      <enabled>Y</enabled>
      <name>LOG_DATE</name>
    </field>
    <field>
      <id>JOBNAME</id>
      <enabled>Y</enabled>
      <name>TRANSNAME</name>
    </field>
    <field>
      <id>JOBENTRYNAME</id>
      <enabled>Y</enabled>
      <name>STEPNAME</name>
    </field>
    <field>
      <id>LINES_READ</id>
      <enabled>Y</enabled>
      <name>LINES_READ</name>
    </field>
    <field>
      <id>LINES_WRITTEN</id>
      <enabled>Y</enabled>
      <name>LINES_WRITTEN</name>
    </field>
    <field>
      <id>LINES_UPDATED</id>
      <enabled>Y</enabled>
      <name>LINES_UPDATED</name>
    </field>
    <field>
      <id>LINES_INPUT</id>
      <enabled>Y</enabled>
      <name>LINES_INPUT</name>
    </field>
    <field>
      <id>LINES_OUTPUT</id>
      <enabled>Y</enabled>
      <name>LINES_OUTPUT</name>
    </field>
    <field>
      <id>LINES_REJECTED</id>
      <enabled>Y</enabled>
      <name>LINES_REJECTED</name>
    </field>
    <field>
      <id>ERRORS</id>
      <enabled>Y</enabled>
      <name>ERRORS</name>
    </field>
    <field>
      <id>RESULT</id>
      <enabled>Y</enabled>
      <name>RESULT</name>
    </field>
    <field>
      <id>NR_RESULT_ROWS</id>
      <enabled>Y</enabled>
      <name>NR_RESULT_ROWS</name>
    </field>
    <field>
      <id>NR_RESULT_FILES</id>
      <enabled>Y</enabled>
      <name>NR_RESULT_FILES</name>
    </field>
    <field>
      <id>LOG_FIELD</id>
      <enabled>N</enabled>
      <name>LOG_FIELD</name>
    </field>
    <field>
      <id>COPY_NR</id>
      <enabled>N</enabled>
      <name>COPY_NR</name>
    </field>
  </jobentry-log-table>
  <channel-log-table>
    <connection/>
    <schema/>
    <table/>
    <timeout_days/>
    <field>
      <id>ID_BATCH</id>
      <enabled>Y</enabled>
      <name>ID_BATCH</name>
    </field>
    <field>
      <id>CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>CHANNEL_ID</name>
    </field>
    <field>
      <id>LOG_DATE</id>
      <enabled>Y</enabled>
      <name>LOG_DATE</name>
    </field>
    <field>
      <id>LOGGING_OBJECT_TYPE</id>
      <enabled>Y</enabled>
      <name>LOGGING_OBJECT_TYPE</name>
    </field>
    <field>
      <id>OBJECT_NAME</id>
      <enabled>Y</enabled>
      <name>OBJECT_NAME</name>
    </field>
    <field>
      <id>OBJECT_COPY</id>
      <enabled>Y</enabled>
      <name>OBJECT_COPY</name>
    </field>
    <field>
      <id>REPOSITORY_DIRECTORY</id>
      <enabled>Y</enabled>
      <name>REPOSITORY_DIRECTORY</name>
    </field>
    <field>
      <id>FILENAME</id>
      <enabled>Y</enabled>
      <name>FILENAME</name>
    </field>
    <field>
      <id>OBJECT_ID</id>
      <enabled>Y</enabled>
      <name>OBJECT_ID</name>
    </field>
    <field>
      <id>OBJECT_REVISION</id>
      <enabled>Y</enabled>
      <name>OBJECT_REVISION</name>
    </field>
    <field>
      <id>PARENT_CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>PARENT_CHANNEL_ID</name>
    </field>
    <field>
      <id>ROOT_CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>ROOT_CHANNEL_ID</name>
    </field>
  </channel-log-table>
  <pass_batchid>N</pass_batchid>
  <shared_objects_file/>
  <entries>
    <entry>
      <name>Start</name>
      <description/>
      <type>SPECIAL</type>
      <attributes/>
      <start>Y</start>
      <dummy>N</dummy>
      <repeat>N</repeat>
      <schedulerType>0</schedulerType>
      <intervalSeconds>0</intervalSeconds>
      <intervalMinutes>60</intervalMinutes>
      <hour>12</hour>
      <minutes>0</minutes>
      <weekDay>1</weekDay>
      <DayOfMonth>1</DayOfMonth>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>16</xloc>
      <yloc>288</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Table exists</name>
      <description/>
      <type>TABLE_EXISTS</type>
      <attributes/>
      <tablename>accountkeys</tablename>
      <schemaname>public</schemaname>
      <connection>tpcdi</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>128</xloc>
      <yloc>288</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>LoadDimensions</name>
      <description/>
      <type>JOB</type>
      <attributes/>
      <specification_method>filename</specification_method>
      <job_object_id/>
      <filename>${Internal.Entry.Current.Directory}/LoadDimensions.kjb</filename>
      <jobname/>
      <directory/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <set_logfile>N</set_logfile>
      <logfile/>
      <logext/>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <loglevel>Nothing</loglevel>
      <slave_server_name/>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <expand_remote_job>Y</expand_remote_job>
      <create_parent_folder>N</create_parent_folder>
      <pass_export>N</pass_export>
      <run_configuration>Pentaho local</run_configuration>
      <parameters>
        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>
      <set_append_logfile>N</set_append_logfile>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>592</xloc>
      <yloc>288</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>LoadLookups</name>
      <description/>
      <type>JOB</type>
      <attributes/>
      <specification_method>filename</specification_method>
      <job_object_id/>
      <filename>${Internal.Entry.Current.Directory}/LoadLookups.kjb</filename>
      <jobname/>
      <directory/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <set_logfile>N</set_logfile>
      <logfile/>
      <logext/>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <loglevel>Nothing</loglevel>
      <slave_server_name/>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <expand_remote_job>N</expand_remote_job>
      <create_parent_folder>N</create_parent_folder>
      <pass_export>N</pass_export>
      <run_configuration>Pentaho local</run_configuration>
      <parameters>
        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>
      <set_append_logfile>N</set_append_logfile>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>448</xloc>
      <yloc>288</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>LoadFacts</name>
      <description/>
      <type>JOB</type>
      <attributes/>
      <specification_method>filename</specification_method>
      <job_object_id/>
      <filename>${Internal.Entry.Current.Directory}/LoadFacts.kjb</filename>
      <jobname/>
      <directory/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <set_logfile>N</set_logfile>
      <logfile/>
      <logext/>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <loglevel>Nothing</loglevel>
      <slave_server_name/>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <expand_remote_job>N</expand_remote_job>
      <create_parent_folder>N</create_parent_folder>
      <pass_export>N</pass_export>
      <run_configuration>Pentaho local</run_configuration>
      <parameters>
        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>
      <set_append_logfile>N</set_append_logfile>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>736</xloc>
      <yloc>288</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Create tables</name>
      <description/>
      <type>SQL</type>
      <attributes/>
      <sql>-- Key tables

/*
CREATE TABLE customerkeys
(
  sk_customerid integer NOT NULL,
  customerid integer NOT NULL,
  CONSTRAINT customerkeys_pkey PRIMARY KEY (sk_customerid)
);

CREATE TABLE brokerkeys
(
  sk_brokerid integer NOT NULL,
  brokerid integer NOT NULL,
  CONSTRAINT brokerkeys_pkey PRIMARY KEY (sk_brokerid)
);

CREATE TABLE accountkeys
(
  sk_accountid integer NOT NULL,
  accountid integer NOT NULL,
  CONSTRAINT accountkeys_pkey PRIMARY KEY (sk_accountid)
);

CREATE TABLE securitykeys
(
  sk_securityid integer NOT NULL
);

CREATE TABLE companykeys
(
  sk_companyid integer NOT NULL,
  companyid integer NOT NULL
);

CREATE TABLE tradekeys
(
  sk_tradeyid integer NOT NULL,
  tradeid integer NOT NULL
);
*/

-- Other tables

--CREATE TYPE taxStatus AS Enumeric ('0', '1', '2');

-- Dimension tables

CREATE TABLE DimBroker  ( SK_BrokerID  INTEGER NOT NULL PRIMARY KEY,
							BrokerID  INTEGER NOT NULL,
							ManagerID  INTEGER,
							FirstName       CHAR(50) NOT NULL,
							LastName       CHAR(50) NOT NULL,
							MiddleInitial       CHAR(1),
							Branch       CHAR(50),
							Office       CHAR(50),
							Phone       CHAR(14),
							IsCurrent boolean NOT NULL,
							BatchID INTEGER NOT NULL,
							EffectiveDate date NOT NULL,
							EndDate date NOT NULL							
);

CREATE TABLE DimCustomer  ( SK_CustomerID  INTEGER NOT NULL PRIMARY KEY,
							CustomerID INTEGER NOT NULL,
							TaxID CHAR(20) NOT NULL,
							Status CHAR(10) NOT NULL,
							LastName CHAR(30) NOT NULL,
							FirstName CHAR(30) NOT NULL,
							MiddleInitial CHAR(1),
							Gender CHAR(1),
							Tier Integer,
							DOB date NOT NULL,
							AddressLine1	varchar(80) NOT NULL,
							AddressLine2	varchar(80),
							PostalCode	char(12) NOT NULL,
							City	char(25) NOT NULL,
							StateProv	char(20) NOT NULL,
							Country	char(24),
							Phone1	char(30),
							Phone2	char(30),
							Phone3	char(30),
							Email1	char(50),
							Email2	char(50),
							NationalTaxRateDesc	varchar(50),
							NationalTaxRate	numeric(6,5),
							LocalTaxRateDesc	varchar(50),
							LocalTaxRate	numeric(6,5),
							AgencyID	char(30),
							CreditRating integer,
							NetWorth	numeric(10),
							MarketingNameplate varchar(100),
							IsCurrent boolean NOT NULL,
							BatchID INTEGER NOT NULL,
							EffectiveDate date NOT NULL,
							EndDate date NOT NULL
);

CREATE TABLE DimAccount  ( SK_AccountID  INTEGER NOT NULL PRIMARY KEY,
                            AccountID  INTEGER NOT NULL,
                            SK_BrokerID  INTEGER NOT NULL REFERENCES DimBroker (SK_BrokerID),
                            SK_CustomerID  INTEGER NOT NULL REFERENCES DimCustomer (SK_CustomerID),
                            Status       CHAR(10) NOT NULL,
                            AccountDesc       varchar(50),
                            TaxStatus  INTEGER NOT NULL CHECK (TaxStatus = 0 OR TaxStatus = 1 OR TaxStatus = 2),
                            IsCurrent boolean NOT NULL,
                            BatchID INTEGER NOT NULL,
                            EffectiveDate date NOT NULL,
                            EndDate date NOT NULL
);


CREATE TABLE DimCompany (   SK_CompanyID INTEGER NOT NULL PRIMARY KEY, 
							CompanyID INTEGER NOT NULL,
							Status CHAR(10) Not NULL, 
							Name CHAR(60) Not NULL,
							Industry CHAR(50) Not NULL,
							SPrating CHAR(4),
							isLowGrade BOOLEAN,
							CEO CHAR(100) Not NULL,
							AddressLine1 CHAR(80),
							AddressLine2 CHAR(80),
							PostalCode CHAR(12) Not NULL,
							City CHAR(25) Not NULL,
							StateProv CHAR(20) Not NULL,
							Country CHAR(24),
							Description CHAR(150) Not NULL,
							FoundingDate DATE,
							IsCurrent BOOLEAN Not NULL,
							BatchID INTEGER Not NULL,
							EffectiveDate DATE Not NULL,
							EndDate DATE Not NULL
);

CREATE TABLE DimDate (  SK_DateID INTEGER Not NULL PRIMARY KEY,
						DateValue DATE Not NULL,
						DateDesc CHAR(20) Not NULL,
						CalendarYearID SMALLINT Not NULL,
						CalendarYearDesc CHAR(20) Not NULL,
						CalendarQtrID INTEGER Not NULL,
						CalendarQtrDesc CHAR(20) Not NULL,
						CalendarMonthID INTEGER Not NULL,
						CalendarMonthDesc CHAR(20) Not NULL,
						CalendarWeekID INTEGER Not NULL,
						CalendarWeekDesc CHAR(20) Not NULL,
						DayOfWeeknumeric SMALLINT Not NULL,
						DayOfWeekDesc CHAR(10) Not NULL,
						FiscalYearID SMALLINT Not NULL,
						FiscalYearDesc CHAR(20) Not NULL,
						FiscalQtrID INTEGER Not NULL,
						FiscalQtrDesc CHAR(20) Not NULL,
						HolidayFlag BOOLEAN
);

CREATE TABLE DimSecurity( SK_SecurityID INTEGER Not NULL PRIMARY KEY,
							Symbol CHAR(15) Not NULL,
							Issue CHAR(6) Not NULL,
							Status CHAR(10) Not NULL,
							Name CHAR(70) Not NULL,
							ExchangeID CHAR(6) Not NULL,
							SK_CompanyID INTEGER Not NULL REFERENCES DimCompany (SK_CompanyID),
							SharesOutstanding INTEGER Not NULL,
							FirstTrade DATE Not NULL,
							FirstTradeOnExchange DATE Not NULL,
							Dividend INTEGER Not NULL,
							IsCurrent BOOLEAN Not NULL,
							BatchID SMALLINT Not NULL,
							EffectiveDate DATE Not NULL,
							EndDate DATE Not NULL
);

CREATE TABLE DimTime ( SK_TimeID INTEGER Not NULL PRIMARY KEY,
						TimeValue TIME WITHOUT TIME ZONE Not NULL,
						HourID INTEGER Not NULL,
						HourDesc CHAR(20) Not NULL,
						MinuteID INTEGER Not NULL,
						MinuteDesc CHAR(20) Not NULL,
						SecondID INTEGER Not NULL,
						SecondDesc CHAR(20) Not NULL,
						MarketHoursFlag BOOLEAN,
						OfficeHoursFlag BOOLEAN
);

CREATE TABLE DimTrade (	TradeID INTEGER Not NULL,
						SK_BrokerID INTEGER REFERENCES DimBroker (SK_BrokerID),
						SK_CreateDateID INTEGER Not NULL REFERENCES DimDate (SK_DateID),
						SK_CreateTimeID INTEGER Not NULL REFERENCES DimTime (SK_TimeID),
						SK_CloseDateID INTEGER REFERENCES DimDate (SK_DateID),
						SK_CloseTimeID INTEGER REFERENCES DimTime (SK_TimeID),
						Status CHAR(10) Not NULL,
						DT_Type CHAR(12) Not NULL,
						CashFlag BOOLEAN Not NULL,
						SK_SecurityID INTEGER Not NULL REFERENCES DimSecurity (SK_SecurityID),
						SK_CompanyID INTEGER Not NULL REFERENCES DimCompany (SK_CompanyID),
						Quantity numeric(6,0) Not NULL,
						BidPrice numeric(8,2) Not NULL,
						SK_CustomerID INTEGER Not NULL REFERENCES DimCustomer (SK_CustomerID),
						SK_AccountID INTEGER Not NULL REFERENCES DimAccount (SK_AccountID),
						ExecutedBy CHAR(64) Not NULL,
						TradePrice numeric(8,2),
						Fee numeric(10,2),
						Commission numeric(10,2),
						Tax numeric(10,2),
						BatchID INTEGER Not Null
);

CREATE TABLE Industry ( IN_ID CHAR(2) Not NULL,
						IN_NAME CHAR(50) Not NULL,
						IN_SC_ID CHAR(4) Not NULL
);

CREATE TABLE Financial ( SK_CompanyID INTEGER Not NULL REFERENCES DimCompany (SK_CompanyID),
						FI_YEAR INTEGER Not NULL,
						FI_QTR INTEGER Not NULL,
						FI_QTR_START_DATE DATE Not NULL,
						FI_REVENUE numeric(15,2) Not NULL,
						FI_NET_EARN numeric(15,2) Not NULL,
						FI_BASIC_EPS numeric(10,2) Not NULL,
						FI_DILUT_EPS numeric(10,2) Not NULL,
						FI_MARGIN numeric(10,2) Not NULL,
						FI_INVENTORY numeric(15,2) Not NULL,
						FI_ASSETS numeric(15,2) Not NULL,
						FI_LIABILITY numeric(15,2) Not NULL,
						FI_OUT_BASIC numeric(12) Not NULL,
						FI_OUT_DILUT numeric(12) Not NULL
);

-- Fact tables

CREATE TABLE FactCashBalances ( SK_CustomerID INTEGER Not Null REFERENCES DimCustomer (SK_CustomerID),
								SK_AccountID INTEGER Not Null REFERENCES DimAccount (SK_AccountID),
								SK_DateID INTEGER Not Null REFERENCES DimDate (SK_DateID),
								Cash numeric(15,2) Not Null,
								BatchID INTEGER
);

CREATE TABLE FactHoldings (	TradeID INTEGER Not NULL,
							CurrentTradeID INTEGER Not Null,
							SK_CustomerID INTEGER Not NULL REFERENCES DimCustomer (SK_CustomerID),
							SK_AccountID INTEGER Not NULL REFERENCES DimAccount (SK_AccountID),
							SK_SecurityID INTEGER Not NULL REFERENCES DimSecurity (SK_SecurityID),
							SK_CompanyID INTEGER Not NULL REFERENCES DimCompany (SK_CompanyID),
							SK_DateID INTEGER Not NULL REFERENCES DimDate (SK_DateID),
							SK_TimeID INTEGER Not NULL REFERENCES DimTime (SK_TimeID),
							CurrentPrice numeric(2) CHECK (CurrentPrice > 0) ,
							CurrentHolding numeric(6) Not NULL,
							BatchID INTEGER
);

CREATE TABLE FactMarketHistory (    SK_SecurityID INTEGER Not Null REFERENCES DimSecurity (SK_SecurityID),
									SK_CompanyID INTEGER Not Null REFERENCES DimCompany (SK_CompanyID),
									SK_DateID INTEGER Not Null REFERENCES DimDate (SK_DateID),
									PERatio numeric(10,9),
									Yield numeric(6,3) Not Null,
									FiftyTwoWeekHigh numeric(8,2), 
									SK_FiftyTwoWeek INTEGER, 
									FiftyTwoWeekLow numeric(8,2), 
									SK_FiftyTwoWeekL INTEGER, 
									ClosePrice numeric(8,2) Not Null,
									DayHigh numeric(8,2) Not Null,
									DayLow numeric(8,2) Not Null,
									Volume numeric(12) Not Null,
									BatchID INTEGER
);

CREATE TABLE FactWatches ( SK_CustomerID INTEGER Not NULL REFERENCES DimCustomer (SK_CustomerID),
							SK_SecurityID INTEGER Not NULL REFERENCES DimSecurity (SK_SecurityID),
							SK_DateID_DatePlaced INTEGER Not NULL REFERENCES DimDate (SK_DateID),
							SK_DateID_DateRemoved INTEGER REFERENCES DimDate (SK_DateID),
							BatchID INTEGER Not Null 
);

CREATE TABLE Prospect ( AgencyID CHAR(30) NOT NULL UNIQUE,  
						SK_RecordDateID INTEGER NOT NULL, 
						SK_UpdateDateID INTEGER NOT NULL REFERENCES DimDate (SK_DateID),
						BatchID INTEGER NOT NULL,
						IsCustomer BOOLEAN NOT NULL,
						LastName CHAR(30) NOT NULL,
						FirstName CHAR(30) NOT NULL,
						MiddleInitial CHAR(1),
						Gender CHAR(1),
						AddressLine1 CHAR(80),
						AddressLine2 CHAR(80),
						PostalCode CHAR(12),
						City CHAR(25) NOT NULL,
						State CHAR(20) NOT NULL,
						Country CHAR(24),
						Phone CHAR(30), 
						Income numeric(9),
						numericberCars INTEGER, 
						numericberChildren INTEGER, 
						MaritalStatus CHAR(1), 
						Age INTEGER,
						CreditRating INTEGER,
						OwnOrRentFlag CHAR(1), 
						Employer CHAR(30),
						numericberCreditCards INTEGER, 
						NetWorth numeric(12),
						MarketingNameplate CHAR(100)
);

-- Type tables

CREATE TABLE StatusType ( ST_ID CHAR(4) Not NULL,
							ST_NAME CHAR(10) Not NULL
);

CREATE TABLE TaxRate ( TX_ID CHAR(4) Not NULL,
						TX_NAME CHAR(50) Not NULL,
						TX_RATE numeric(6,5) Not NULL
);

CREATE TABLE TradeType ( TT_ID CHAR(3) Not NULL,
							TT_NAME CHAR(12) Not NULL,
							TT_IS_SELL numeric(1) Not NULL,
							TT_IS_MRKT numeric(1) Not NULL
);

-- Audit tables

CREATE TABLE DImessages ( MessageDateAndTime TIMESTAMP Not NULL,
							BatchID INTEGER Not NULL,
							MessageSource CHAR(30),
							MessageText CHAR(50) Not NULL,
							MessageType CHAR(12) Not NULL,
							MessageData CHAR(100)
);

CREATE TABLE AuditTable ( DataSet CHAR(20) Not Null,
							BatchID INTEGER,
							AT_Date DATE,
							AT_Attribute CHAR(50),
							AT_Value numeric(15),
							DValue numeric(15,5)
);

</sql>
      <useVariableSubstitution>F</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>tpcdi</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>288</xloc>
      <yloc>288</yloc>
      <attributes_kjc/>
    </entry>
    <entry>
      <name>Drop tables</name>
      <description/>
      <type>SQL</type>
      <attributes/>
      <sql>-- Fact tables

DROP TABLE FactCashBalances CASCADE;

DROP TABLE FactHoldings  CASCADE;

DROP TABLE FactMarketHistory  CASCADE;

DROP TABLE FactWatches CASCADE ;

DROP TABLE Prospect  CASCADE;

-- Other tables

DROP TABLE Industry CASCADE;

DROP TABLE Financial  CASCADE;

DROP TABLE StatusType  CASCADE;

DROP TABLE TaxRate CASCADE;

DROP TABLE TradeType  CASCADE;

-- Dimension tables

DROP TABLE DimAccount CASCADE;

DROP TABLE DimBroker CASCADE;

DROP TABLE DimCustomer  CASCADE ;

DROP TABLE DimCompany  CASCADE;

DROP TABLE DimDate CASCADE;

DROP TABLE DimSecurity CASCADE;

DROP TABLE DimTime  CASCADE;

DROP TABLE DimTrade  CASCADE;

-- Audit tables

DROP TABLE AuditTable  CASCADE;

DROP TABLE DImessages  CASCADE;

-- Key tables
/*
DROP TABLE customerkeys CASCADE;

DROP TABLE brokerkeys CASCADE;

DROP TABLE accountkeys CASCADE;

DROP TABLE securitykeys CASCADE;

DROP TABLE companykeys CASCADE;

DROP TABLE tradekeys CASCADE;
*/
</sql>
      <useVariableSubstitution>F</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>tpcdi</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>192</xloc>
      <yloc>192</yloc>
      <attributes_kjc/>
    </entry>
  </entries>
  <hops>
    <hop>
      <from>Start</from>
      <to>Table exists</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>LoadLookups</from>
      <to>LoadDimensions</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>LoadDimensions</from>
      <to>LoadFacts</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Create tables</from>
      <to>LoadLookups</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Table exists</from>
      <to>Create tables</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Table exists</from>
      <to>Drop tables</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Drop tables</from>
      <to>Create tables</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
  </hops>
  <notepads>
  </notepads>
  <attributes>
    <group>
      <name>METASTORE.pentaho</name>
      <attribute>
        <key>Default Run Configuration</key>
        <value>{"namespace":"pentaho","id":"Default Run Configuration","name":"Default Run Configuration","description":"Defines a default run configuration","metaStoreName":null}</value>
      </attribute>
    </group>
    <group>
      <name>{"_":"Embedded MetaStore Elements","namespace":"pentaho","type":"Default Run Configuration"}</name>
      <attribute>
        <key>Pentaho local</key>
        <value>{"children":[{"children":[],"id":"server","value":null},{"children":[],"id":"clustered","value":"N"},{"children":[],"id":"name","value":"Pentaho local"},{"children":[],"id":"description","value":null},{"children":[],"id":"pentaho","value":"N"},{"children":[],"id":"readOnly","value":"Y"},{"children":[],"id":"sendResources","value":"N"},{"children":[],"id":"logRemoteExecutionLocally","value":"N"},{"children":[],"id":"remote","value":"N"},{"children":[],"id":"local","value":"Y"},{"children":[],"id":"showTransformations","value":"N"}],"id":"Pentaho local","value":null,"name":"Pentaho local","owner":null,"ownerPermissionsList":[]}</value>
      </attribute>
    </group>
  </attributes>
</job>
